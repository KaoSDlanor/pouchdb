/*
 * Simple task queue to sequentialize actions. Assumes
 * callbacks will eventually fire (once).
 */


class TaskQueue {
  constructor() {
    this.promise = new Promise(function (fulfill) {fulfill(); });
  }

  add(promiseFactory) {
    this.promise = this.promise.catch(function () {
      // just recover
    }).then(function () {
      return promiseFactory();
    });
    return this.promise;
  }

  finish() {
    const output = this.promise;
    this.promise = this.promise.then(() => {}); // Release reference to the return value of this.promise so it can be garbage collected
    return output;
  }
}

export default TaskQueue;
